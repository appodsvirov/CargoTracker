@page "/"

<PageTitle>Home</PageTitle>

@inject CargoTracker.Web.Domain.Abstractions.IDataManagerApiClient Api
@inject Radzen.NotificationService Notifications
@inject NavigationManager Nav

<RadzenStack Orientation="Orientation.Vertical" Gap="12px" Style="max-width:520px">
    <h3>Go to cargo tracks</h3>
    <RadzenStack Orientation="Orientation.Horizontal" Gap="8px" AlignItems="AlignItems.Center">
        <RadzenTextBox @bind-Value="cargoIdText" Placeholder="Enter cargo ID (GUID)" Style="width:360px" Change="OnChange" />
        <RadzenButton Text="Search" Icon="search" Click="OnSearch" />
    </RadzenStack>
    @if (!string.IsNullOrWhiteSpace(error))
    {
        <RadzenAlert Severity="AlertSeverity.Warning" Style="max-width:520px">@error</RadzenAlert>
    }
</RadzenStack>

@code {
    private string? cargoIdText;
    private string? error;

    private Task OnChange(object? _)
    {
        error = null;
        return Task.CompletedTask;
    }

    private async Task OnSearch()
    {
        error = null;
        if (!Guid.TryParse(cargoIdText, out var id))
        {
            error = "Invalid GUID format";
            return;
        }

        try
        {
            var cargo = await Api.GetCargoAsync(id);
            if (cargo is null)
            {
                error = "Cargo not found";
                return;
            }
            Nav.NavigateTo($"/cargos/{id}/tracks");
        }
        catch (Exception ex)
        {
            error = "Cargo not found";
            Notifications.Notify(Radzen.NotificationSeverity.Error, "Cargo search error", ex.Message);
        }
    }
}
